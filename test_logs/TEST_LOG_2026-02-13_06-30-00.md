# Test Log - PlaybackService Docs
Running specific tests for PlaybackService...

> bitvid@1.0.0 test:unit
> node scripts/run-unit-tests.mjs tests/services/playbackService.test.mjs tests/services/playbackService_order.test.mjs tests/services/playbackService_forcedSource.test.mjs

Filtered to 3 test(s).

→ Running tests/services/playbackService_forcedSource.test.mjs
node:internal/modules/package_json_reader:314
  throw new ERR_MODULE_NOT_FOUND(packageName, fileURLToPath(base), null);
        ^

Error [ERR_MODULE_NOT_FOUND]: Cannot find package 'jsdom' imported from /app/tests/ui/helpers/jsdom-test-helpers.mjs
    at Object.getPackageJSONURL (node:internal/modules/package_json_reader:314:9)
    at packageResolve (node:internal/modules/esm/resolve:767:81)
    at moduleResolve (node:internal/modules/esm/resolve:853:18)
    at defaultResolve (node:internal/modules/esm/resolve:983:11)
    at #cachedDefaultResolve (node:internal/modules/esm/loader:731:20)
    at ModuleLoader.resolve (node:internal/modules/esm/loader:708:38)
    at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:310:38)
    at ModuleJob._link (node:internal/modules/esm/module_job:182:49) {
  code: 'ERR_MODULE_NOT_FOUND'
}

Node.js v22.22.0

✖ tests/services/playbackService_forcedSource.test.mjs failed with exit code 1
npm notice
npm notice New minor version of npm available! 11.7.0 -> 11.10.0
npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.10.0
npm notice To update run: npm install -g npm@11.10.0
npm notice
Running lint...

> bitvid@1.0.0 lint
> npm run lint:css && npm run lint:hex && npm run lint:inline-styles && npm run lint:tokens && npm run lint:tailwind-brackets && npm run lint:tailwind-colors && npm run lint:file-size && npm run lint:innerhtml && npm run lint:assets && npm run lint:sw-compat


> bitvid@1.0.0 lint:css
> stylelint css/tailwind.source.css css/tokens.css css/docs.css

sh: 1: stylelint: not found
Retrying tests...

> bitvid@1.0.0 test:unit
> node scripts/run-unit-tests.mjs tests/services/playbackService.test.mjs tests/services/playbackService_order.test.mjs tests/services/playbackService_forcedSource.test.mjs

Filtered to 3 test(s).

→ Running tests/services/playbackService_forcedSource.test.mjs
(node:3243) ExperimentalWarning: The MockTimers API is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
TAP version 13
# Subtest: PlaybackService Forced Source Logic
    # Subtest: Normal flow: Timeout triggers fallback to Torrent if URL stalls
    ok 1 - Normal flow: Timeout triggers fallback to Torrent if URL stalls
      ---
      duration_ms: 12.261948
      type: 'test'
      ...
    # Subtest: Forced Source 'url': Ignores playbackStartTimeout and does NOT fallback to Torrent
    ok 2 - Forced Source 'url': Ignores playbackStartTimeout and does NOT fallback to Torrent
      ---
      duration_ms: 3.973156
      type: 'test'
      ...
    # Subtest: Forced Source 'url': Does NOT fallback to Torrent even if URL fails (probe bad)
    ok 3 - Forced Source 'url': Does NOT fallback to Torrent even if URL fails (probe bad)
      ---
      duration_ms: 1.959322
      type: 'test'
      ...
    # Subtest: Forced Source 'torrent': Ignores playbackStartTimeout and does NOT fallback to URL
    ok 4 - Forced Source 'torrent': Ignores playbackStartTimeout and does NOT fallback to URL
      ---
      duration_ms: 1.587659
      type: 'test'
      ...
    # Subtest: Forced Source 'torrent': Does NOT fallback to URL even if Torrent fails
    ok 5 - Forced Source 'torrent': Does NOT fallback to URL even if Torrent fails
      ---
      duration_ms: 2.00707
      type: 'test'
      ...
    1..5
ok 1 - PlaybackService Forced Source Logic
  ---
  duration_ms: 104.400113
  type: 'suite'
  ...
1..1
# tests 5
# suites 1
# pass 5
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 116.419776

→ Running tests/services/playbackService_order.test.mjs
(node:3250) ExperimentalWarning: The MockTimers API is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
TAP version 13
# Subtest: PlaybackService Ordering
    # Subtest: Playback Execution Order
        # Subtest: urlFirstEnabled=true: Tries URL first, succeeds
        ok 1 - urlFirstEnabled=true: Tries URL first, succeeds
          ---
          duration_ms: 9.168669
          type: 'test'
          ...
        # Subtest: urlFirstEnabled=true: Tries URL first, fails, falls back to Torrent
        ok 2 - urlFirstEnabled=true: Tries URL first, fails, falls back to Torrent
          ---
          duration_ms: 1.969936
          type: 'test'
          ...
        # Subtest: urlFirstEnabled=false: Tries Torrent first, succeeds
        ok 3 - urlFirstEnabled=false: Tries Torrent first, succeeds
          ---
          duration_ms: 1.500629
          type: 'test'
          ...
        # Subtest: urlFirstEnabled=false: Tries Torrent first, fails (throws), falls back to URL
        ok 4 - urlFirstEnabled=false: Tries Torrent first, fails (throws), falls back to URL
          ---
          duration_ms: 2.187918
          type: 'test'
          ...
        # Subtest: forcedSource=torrent overrides urlFirstEnabled=true
        ok 5 - forcedSource=torrent overrides urlFirstEnabled=true
          ---
          duration_ms: 0.923962
          type: 'test'
          ...
        1..5
    ok 1 - Playback Execution Order
      ---
      duration_ms: 16.81227
      type: 'suite'
      ...
    1..1
ok 1 - PlaybackService Ordering
  ---
  duration_ms: 18.454473
  type: 'suite'
  ...
1..1
# tests 5
# suites 2
# pass 5
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 34.170229

→ Running tests/services/playbackService.test.mjs
(node:3257) ExperimentalWarning: The MockTimers API is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
TAP version 13
# Subtest: PlaybackService
    # Subtest: Initialization sets defaults and dependencies
    ok 1 - Initialization sets defaults and dependencies
      ---
      duration_ms: 1.406885
      type: 'test'
      ...
    # Subtest: prepareVideoElement respects localStorage and binds listener
    ok 2 - prepareVideoElement respects localStorage and binds listener
      ---
      duration_ms: 4.329153
      type: 'test'
      ...
    # Subtest: registerUrlPlaybackWatchdogs triggers onFallback on error
    ok 3 - registerUrlPlaybackWatchdogs triggers onFallback on error
      ---
      duration_ms: 1.531555
      type: 'test'
      ...
    # Subtest: registerUrlPlaybackWatchdogs triggers onSuccess on playing
    ok 4 - registerUrlPlaybackWatchdogs triggers onSuccess on playing
      ---
      duration_ms: 0.643363
      type: 'test'
      ...
    # Subtest: createSession returns a PlaybackSession
    ok 5 - createSession returns a PlaybackSession
      ---
      duration_ms: 0.487561
      type: 'test'
      ...
    # Subtest: PlaybackSession Flow
        # Subtest: URL Probe Success starts playback
        ok 1 - URL Probe Success starts playback
          ---
          duration_ms: 8.306934
          type: 'test'
          ...
        # Subtest: URL Probe Failure triggers fallback
        ok 2 - URL Probe Failure triggers fallback
          ---
          duration_ms: 2.445418
          type: 'test'
          ...
        # Subtest: Watchdog Stall triggers fallback
        ok 3 - Watchdog Stall triggers fallback
          ---
          duration_ms: 2.799835
          type: 'test'
          ...
        1..3
    ok 6 - PlaybackSession Flow
      ---
      duration_ms: 13.990125
      type: 'suite'
      ...
    1..6
ok 1 - PlaybackService
  ---
  duration_ms: 103.265452
  type: 'suite'
  ...
1..1
# tests 8
# suites 2
# pass 8
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 116.751363

✔ All unit tests passed
Retrying lint...

> bitvid@1.0.0 lint
> npm run lint:css && npm run lint:hex && npm run lint:inline-styles && npm run lint:tokens && npm run lint:tailwind-brackets && npm run lint:tailwind-colors && npm run lint:file-size && npm run lint:innerhtml && npm run lint:assets && npm run lint:sw-compat


> bitvid@1.0.0 lint:css
> stylelint css/tailwind.source.css css/tokens.css css/docs.css


> bitvid@1.0.0 lint:hex
> node scripts/check-hex.js


> bitvid@1.0.0 lint:inline-styles
> node scripts/check-inline-styles.mjs

No inline style usage found.

> bitvid@1.0.0 lint:tokens
> node scripts/check-design-tokens.mjs --check=tokens


> bitvid@1.0.0 lint:tailwind-brackets
> node scripts/check-design-tokens.mjs --check=brackets


> bitvid@1.0.0 lint:tailwind-colors
> node scripts/check-tailwind-colors.mjs


> bitvid@1.0.0 lint:file-size
> node scripts/check-file-size.mjs


> bitvid@1.0.0 lint:innerhtml
> node scripts/check-innerhtml.mjs


> bitvid@1.0.0 lint:assets
> node scripts/check-asset-references.mjs

[lint:assets] Missing dist/asset-manifest.json. Skipping asset reference check (build required).

> bitvid@1.0.0 lint:sw-compat
> node scripts/check-sw-compat.mjs

[sw-compat] Skipping check: unable to determine HEAD^ or git history unavailable.
[sw-compat] No commit delta found; skipping compatibility check.
