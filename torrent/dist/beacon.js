var ye=Object.freeze([]);var k=Object.freeze({light:Object.freeze({accent:"#fe0032",accentStrong:"#540011",accentPressed:"#a90021"}),dark:Object.freeze({accent:"#fe0032",accentStrong:"#540011",accentPressed:"#a90021"})});var be=Object.freeze(["watch-history:v2:index"]);var ge=1440*60*1e3;var _e=300*1e3;var F=!!!0;typeof window<"u"&&(window.__BITVID_DEV_MODE__=F);var P=()=>{};function Ae(){return typeof console>"u"||console===null?null:console}function Ce(){let e=Ae();if(!e)return{log:P,info:P,warn:P,error:P};let t=typeof e.log=="function"?e.log.bind(e):P;return{log:typeof e.log=="function"?e.log.bind(e):t,info:typeof e.info=="function"?e.info.bind(e):t,warn:typeof e.warn=="function"?e.warn.bind(e):t,error:typeof e.error=="function"?e.error.bind(e):t}}var S=Ce(),M="[bitvid]";function ee(e){if(e.length===0)return{args:e,force:!1};let t=e[e.length-1];if(t&&typeof t=="object"&&!Array.isArray(t)&&Object.prototype.hasOwnProperty.call(t,"force")){let r=[...e],o=r.pop();return{args:r,force:!!o.force}}return{args:e,force:!1}}var L=Object.freeze({log:(...e)=>{F&&S.log(...e)},info:(...e)=>{F&&S.info(...e)},warn:(...e)=>{F&&S.warn(...e)},error:(...e)=>{F&&S.error(...e)}}),E=Object.freeze({log:(...e)=>{let{args:t,force:r}=ee(e);if(!r&&t.length===0)return;if(r){S.log(M,...t);return}let[o,...n]=t;if(typeof o=="string"&&n.length===0){S.log(`${M} ${o}`);return}o!==void 0&&S.log(M,o)},info:(...e)=>{let{args:t,force:r}=ee(e);if(!r&&t.length===0)return;if(r){S.info(M,...t);return}let[o,...n]=t;if(typeof o=="string"&&n.length===0){S.info(`${M} ${o}`);return}o!==void 0&&S.info(M,o)},warn:(...e)=>{S.warn(M,...e)},error:(...e)=>{S.error(M,...e)}}),te=Object.freeze({dev:L,user:E});function we(e){if(!e||typeof e!="object")return!1;let t=["dev","user"],r=["log","info","warn","error"];return t.every(o=>{let n=e[o];return n&&typeof n=="object"&&r.every(l=>typeof n[l]=="function")})}typeof window<"u"&&(we(window.bitvidLogger)||(window.bitvidLogger=te));Object.freeze(te);var G="bitvid:theme",N="dark",Le=new Set(["light","dark"]),re={dark:"#0f172a",light:"#f8fafc"},ne=["[data-theme-toggle]",'[data-action="toggle-theme"]',".js-theme-toggle","#themeToggle"],xe=Object.freeze({accent:"--color-accent",accentStrong:"--color-accent-strong",accentPressed:"--color-accent-pressed"}),oe=new WeakSet,V=new Set,R=null,ae=!1,I=()=>typeof window<"u"&&typeof document<"u",q=e=>{if(typeof e!="string")return null;let t=e.trim().toLowerCase();return t==="default"||t===""?N:Le.has(t)?t:null},Ie=()=>{if(!I())return null;try{let e=window.localStorage.getItem(G);return q(e)}catch(e){return E.warn("Unable to read stored theme preference:",e),null}},ve=e=>{if(I())try{window.localStorage.setItem(G,e)}catch(t){E.warn("Unable to persist theme preference:",t)}},K=()=>{if(!I())return null;let{documentElement:e}=document;return e instanceof HTMLElement?e:null},Ne=e=>typeof e=="string"?e.trim():"",Oe=(e,t)=>{if(!e)return;let r=k&&typeof k=="object"&&k[t]&&typeof k[t]=="object"?k[t]:null;Object.entries(xe).forEach(([o,n])=>{let l=r?r[o]:null,a=Ne(l);a?e.style.setProperty(n,a):e.style.removeProperty(n)})},Be=e=>{if(!I())return;let t=document.querySelector('meta[name="theme-color"]');if(!t)return;let r=K();if(!r)return;let o="";try{typeof window.getComputedStyle=="function"&&(o=getComputedStyle(r).getPropertyValue("--color-page").trim())}catch(a){E.warn("Unable to compute theme color token:",a)}let n=re[e]||re[N],l=o||n;l&&t.setAttribute("content",l)},se=(e,t)=>{if(!(e instanceof HTMLElement))return;e.dataset.themeState=t,e.setAttribute("aria-pressed",t==="dark"?"true":"false");let r=t==="dark"?"Switch to light theme":"Switch to dark theme";e.setAttribute("aria-label",r),e.setAttribute("title",r);let o=e.querySelector("[data-theme-toggle-label]")||e.querySelector(".sr-only");o&&(o.textContent=r);let n=e.querySelector("[data-theme-toggle-icon]")||e.querySelector('[aria-hidden="true"]');if(n){let l=typeof SVGElement<"u"?SVGElement:null;if(l&&n instanceof l||n instanceof Element&&!!n.querySelector("svg"))n instanceof Element&&n.setAttribute("data-theme-icon-state",t);else{let p=e.dataset.iconLight||"\u2600\uFE0F",d=e.dataset.iconDark||"\u{1F319}";n.textContent=t==="dark"?p:d}}},Me=()=>{if(!I()){V.clear();return}V.forEach(e=>{(!(e instanceof HTMLElement)||!document.contains(e))&&V.delete(e)})},He=e=>{Me(),V.forEach(t=>{se(t,e)})},Re=e=>{!(e instanceof HTMLElement)||oe.has(e)||(e.addEventListener("click",t=>{t.preventDefault(),ke(R==="dark"?"light":"dark")}),e.dataset.themeToggleBound="true",oe.add(e))},De=(e=document)=>{if(!I())return[];let t=new Set,r=e&&typeof e.querySelectorAll=="function"?e:document;return ne.forEach(o=>{try{r.querySelectorAll(o).forEach(n=>{n instanceof HTMLElement&&t.add(n)})}catch(n){E.warn(`Invalid selector for theme toggle: ${o}`,n)}}),e instanceof HTMLElement&&ne.forEach(o=>{e.matches(o)&&t.add(e)}),Array.from(t)},X=(e,{persist:t=!0}={})=>{let r=q(e)||N;R=r;let o=K();return o&&(o.dataset.theme=r,Oe(o,r)),t&&ve(r),Be(r),He(r),r},ke=e=>I()?X(e,{persist:!0}):(R=q(e)||N,R),Fe=(e=document)=>{if(!I())return;De(e).forEach(r=>{V.add(r),Re(r),se(r,R||N)})},Ue=()=>{if(!I())return N;let e=K();return(e?q(e.dataset.theme):null)||Ie()||N},We=e=>{if(!e||e.key!==G)return;let t=q(e.newValue)||N;t!==R&&X(t,{persist:!1})},ie=()=>{if(!I()){R=N;return}ae||(window.addEventListener("storage",We),ae=!0);let e=Ue();X(e,{persist:!0}),Fe(document)};var ce={info:"torrent-toast torrent-toast--info",success:"torrent-toast torrent-toast--success",error:"torrent-toast torrent-toast--error",warn:"torrent-toast torrent-toast--warn"},le="transition duration-200 ease-out",Pe="beacon-toast-motion",Z="data-beacon-motion";function Ve(e,t){let r=e?.defaultView;if(r&&typeof r.requestAnimationFrame=="function"){r.requestAnimationFrame(t);return}setTimeout(t,16)}function qe(e){let t=e||(typeof document<"u"?document:null);if(!t)return null;let r=t.getElementById("beacon-toast-container");if(!r){r=t.createElement("div"),r.id="beacon-toast-container",r.setAttribute("role","region"),r.setAttribute("aria-live","polite"),r.className=["pointer-events-none","fixed","inset-x-0","top-0","z-overlay-toast","flex","w-full","flex-col","items-center","gap-3","px-4","pt-6","sm:items-end","sm:px-6","sm:pt-8"].join(" ");let o=t.body||t.getElementsByTagName?.("body")?.[0];o&&o.appendChild(r)}return r}function Ye(e,t,r){let o=e.createElement("div");o.className=[le,r].join(" "),o.setAttribute("role","status"),o.setAttribute("tabindex","0"),o.textContent=t;let n=e.createElement("button");n.type="button",n.className=["notification-dismiss","focus-ring","absolute","right-3","top-3"].join(" "),n.setAttribute("aria-label","Dismiss notification"),n.innerHTML='<svg class="h-4 w-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M3.75 3.75l8.5 8.5"></path><path d="M12.25 3.75l-8.5 8.5"></path></svg>';let l=e.createElement("div");return l.className=["relative","w-full",le,Pe].join(" "),l.setAttribute(Z,"exit"),l.appendChild(o),o.appendChild(n),{wrapper:l,toast:o,closeButton:n}}function je(e,t=setTimeout,r=clearTimeout){return{show(o,n={}){if(!o)return;let l=n.type&&ce[n.type]?n.type:"info",a=qe(e);if(!a)return;let{wrapper:p,toast:d,closeButton:A}=Ye(e,o,ce[l]);a.appendChild(p),Ve(e,()=>{p.setAttribute(Z,"enter")});let _=typeof n.duration=="number"?n.duration:3500,m=()=>{p.setAttribute(Z,"exit");let B=t(()=>{p.parentNode&&p.parentNode.removeChild(p)},200);return A.removeEventListener("click",C),d.removeEventListener("keydown",T),A.removeEventListener("keydown",T),B},C=()=>m(),T=B=>{B.key==="Escape"&&(B.stopPropagation(),m())};A.addEventListener("click",C),d.addEventListener("keydown",T),A.addEventListener("keydown",T);let O=null;return n.sticky||(O=t(()=>{m()},_)),{dismiss(){O&&r(O),m()}}},set(o,n){return typeof n=="string"?this.show(o,{type:n}):this.show(o,n)},info(o,n={}){return this.show(o,{...n,type:"info"})},success(o,n={}){return this.show(o,{...n,type:"success"})},error(o,n={}){return this.show(o,{...n,type:"error"})},warn(o,n={}){return this.show(o,{...n,type:"warn"})}}}function de(e,t=setTimeout,r=clearTimeout){return je(e,t,r)}var J=[{key:"name",label:"Name",headerClass:"w-full sm:w-1/3 text-left",cellClass:"font-medium text-text truncate"},{key:"progress",label:"Progress",headerClass:"w-24 text-right",cellClass:"tabular-nums text-right",formatter:"progress"},{key:"downloadSpeed",label:"\u2193 Speed",headerClass:"w-24 text-right",cellClass:"tabular-nums text-right",formatter:"bytesPerSecond"},{key:"uploadSpeed",label:"\u2191 Speed",headerClass:"w-24 text-right",cellClass:"tabular-nums text-right",formatter:"bytesPerSecond"},{key:"numPeers",label:"Peers",headerClass:"w-20 text-right",cellClass:"tabular-nums text-right",formatter:"integer"},{key:"ratio",label:"Ratio",headerClass:"w-20 text-right",cellClass:"tabular-nums text-right",formatter:"ratio"}];function $e(e){return e?e.infoHash||e.magnetURI||e.name||String(Math.random()):""}function ze(e,t){return!e||!t?!1:e===t||e.magnetURI&&e.magnetURI===t.magnetURI||e.infoHash&&e.infoHash===t.infoHash}function Ge(e){return typeof e!="number"||Number.isNaN(e)?"":`${(e*100).toFixed(1)}%`}function Ke(e){return typeof e!="number"||!Number.isFinite(e)?"0.00":e.toFixed(2)}function Xe(e){return typeof e!="number"||!Number.isFinite(e)?"0":Math.max(0,Math.floor(e)).toString()}function Ze(e,t){if(typeof t=="function")return t(e,!0)||"";if(typeof e!="number"||Number.isNaN(e)||e<1)return"";let r=["B","kB","MB","GB","TB"],o=Math.min(Math.floor(Math.log(e)/Math.log(1e3)),r.length-1);return`${(e/Math.pow(1e3,o)).toFixed(1)} ${r[o]}/s`}function Je(e,t){let r=e.formatter;if(typeof r=="function")return r;let o=t?.[r];if(typeof o=="function")return o;switch(r){case"progress":return Ge;case"ratio":return Ke;case"integer":return Xe;case"bytesPerSecond":return n=>Ze(n,t?.bytes);default:return n=>n}}function ue({documentRef:e=typeof document<"u"?document:null,root:t,onSelect:r,formatters:o={}}={}){if(!e)throw new Error("createTorrentTable requires a document reference");if(!(t instanceof e.defaultView.HTMLElement))throw new Error("createTorrentTable requires a valid root element");let n=e;t.innerHTML="";let l=n.createElement("div");l.className="overflow-hidden rounded-xl border border-border-translucent bg-surface shadow-sm";let a=n.createElement("div");a.className="overflow-x-auto",l.appendChild(a);let p=n.createElement("table");p.className="min-w-full divide-y divide-border-translucent text-sm",a.appendChild(p);let d=n.createElement("thead");d.className="bg-surface-alt text-muted-strong";let A=n.createElement("tr");J.forEach(y=>{let x=n.createElement("th");x.setAttribute("scope","col"),x.className="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide",y.headerClass&&(x.className+=` ${y.headerClass}`),x.textContent=y.label,A.appendChild(x)}),d.appendChild(A),p.appendChild(d);let _=n.createElement("tbody");_.className="divide-y divide-border-translucent",p.appendChild(_);let m=n.createElement("tbody"),C=n.createElement("tr"),T=n.createElement("td");T.className="px-4 py-8 text-center text-sm text-muted",T.colSpan=J.length,T.textContent="No active torrents yet. Add a magnet link to get started.",C.appendChild(T),m.appendChild(C),p.appendChild(m),t.appendChild(l);function O(y=[],x=null){let U=Array.isArray(y)?y:[];if(_.innerHTML="",!U.length){_.hidden=!0,m.hidden=!1;return}_.hidden=!1,m.hidden=!0;for(let v of U){let g=n.createElement("tr");g.className=["group","align-middle","cursor-pointer","transition","hover:bg-panel-hover","focus-visible:outline","focus-visible:outline-2","focus-visible:outline-offset-2","focus-visible:outline-info"].join(" "),g.setAttribute("role","button"),g.setAttribute("tabindex","0"),g.dataset.torrentId=$e(v),ze(x,v)?(g.classList.add("bg-info/10","text-text"),g.setAttribute("aria-pressed","true")):g.setAttribute("aria-pressed","false"),g.addEventListener("click",()=>{typeof r=="function"&&r(v)}),g.addEventListener("keydown",w=>{(w.key==="Enter"||w.key===" ")&&(w.preventDefault(),typeof r=="function"&&r(v))}),J.forEach(w=>{let D=n.createElement("td");D.className="px-4 py-3",w.cellClass&&(D.className+=` ${w.cellClass}`);let z=v?v[w.key]:void 0,s=Je(w,o)(z,v,w),i=n.createElement("span");i.textContent=s==null?"":String(s),D.appendChild(i),g.appendChild(D)}),_.appendChild(g)}}function B(){t.innerHTML=""}return{render:O,destroy:B}}var Qe="2.0",he=["wss://tracker.btorrent.xyz","wss://tracker.openwebtorrent.com"],fe={announce:he},et={announce:he};function Y(e,t=!1){if(typeof e!="number"||Number.isNaN(e))return"";if(e<1)return t?"":"0 B";let r=["B","kB","MB","GB","TB"],o=Math.min(Math.floor(Math.log(e)/Math.log(1e3)),r.length-1);return`${(e/Math.pow(1e3,o)).toFixed(1)} ${r[o]}${t?"/s":""}`}function tt(e){return typeof e!="number"||Number.isNaN(e)?"":`${(e*100).toFixed(1)}%`}function pe(e){return typeof e!="number"||!Number.isFinite(e)?"0.00":e.toFixed(2)}function rt(e,t){return!e||!t?!1:!!(e===t||e.infoHash&&t.infoHash&&e.infoHash===t.infoHash||e.magnetURI&&t.magnetURI&&e.magnetURI===t.magnetURI)}function nt(e){if(!(!e||!Array.isArray(e.files))&&(e.files.forEach(t=>{typeof t.priority!="string"&&(t.priority="0"),typeof t.getBlobURL=="function"&&t.getBlobURL((r,o)=>{r||!o||(t.url=o)})}),e.torrentFile&&typeof Blob=="function"&&typeof URL<"u"))try{let t=new Blob([e.torrentFile],{type:"application/x-bittorrent"});if(e.torrentFileBlobURL=URL.createObjectURL(t),!e.fileName){let r=e.name||"download";e.fileName=`${r}.torrent`}}catch(t){L.warn("[beacon] Failed to create torrent blob URL",t)}}function ot(e,t){if(!e)return;let r=typeof t=="string"?t:String(t??"0");if(e.priority=r,r==="-1"){typeof e.deselect=="function"&&e.deselect();return}let o=Number.parseInt(r,10);Number.isFinite(o)&&typeof e.select=="function"&&e.select(o)}function me(e,t){if(!Array.isArray(t)||t.length===0)return null;if(!e)return t[0];let r=t.find(o=>rt(o,e));return r||t[0]}function Ee({documentRef:e=typeof document<"u"?document:null,WebTorrentCtor:t}={}){if(!e)throw new Error("createBeaconApp requires a document reference");let r=e.defaultView||globalThis,o=typeof t=="function"?t:typeof r?.WebTorrent=="function"?r.WebTorrent:null;if(!o)throw new Error("createBeaconApp requires a WebTorrent constructor");let n=de(e),l=new o({tracker:et}),a={form:e.querySelector('[data-beacon="magnet-form"]'),magnetInput:e.querySelector('[data-beacon="magnet-input"]'),seedButton:e.querySelector('[data-beacon="seed-button"]'),seedInput:e.querySelector('[data-beacon="seed-input"]'),tableRoot:e.querySelector('[data-beacon="torrent-table"]'),selectedSection:e.querySelector('[data-beacon="selected"]'),selectedName:e.querySelector('[data-beacon="selected-name"]'),pauseButton:e.querySelector('[data-beacon-action="pause"]'),resumeButton:e.querySelector('[data-beacon-action="resume"]'),downloadAllButton:e.querySelector('[data-beacon-action="download-all"]'),removeButton:e.querySelector('[data-beacon-action="remove"]'),copyMagnetButton:e.querySelector('[data-beacon-action="copy-magnet"]'),infoHashValue:e.querySelector('[data-beacon="info-hash"]'),fileList:e.querySelector('[data-beacon="file-list"]'),stats:e.querySelector('[data-beacon="client-stats"]'),overlay:e.querySelector('[data-beacon="processing-overlay"]')},p=a.tableRoot?ue({documentRef:e,root:a.tableRoot,formatters:{bytes:(s,i=!1)=>Y(s,i),progress:s=>tt(s),ratio:s=>pe(s),integer:s=>typeof s=="number"&&Number.isFinite(s)?Math.floor(s).toString():"0",bytesPerSecond:s=>Y(s,!0)},onSelect(s){d.selectedTorrent=s,y()}}):null,d={selectedTorrent:null,processing:!1},A=[],_=[];function m(s){A.push(s)}function C(s){if(d.processing=!!s,!a.overlay)return;let i=d.processing;a.overlay.hidden=!i,a.overlay.setAttribute("aria-hidden",i?"false":"true"),i?a.overlay.style.removeProperty("display"):a.overlay.style.display="none"}function T(){return Array.isArray(l.torrents)?[...l.torrents]:[]}function O(){if(!a.stats)return;let s=Y(l.downloadSpeed,!0)||"0 B/s",i=Y(l.uploadSpeed,!0)||"0 B/s",f=pe(l.ratio);a.stats.textContent=`Client stats: \u2193 ${s} \xB7 \u2191 ${i} \xB7 Ratio: ${f}`}function B(s){a.fileList&&(a.fileList.innerHTML="",!(!s||!Array.isArray(s.files)||!s.files.length)&&s.files.forEach((i,f)=>{let u=e.createElement("tr");u.className="align-top";let c=e.createElement("td");if(c.className="px-3 py-2",i.done&&i.url){let b=e.createElement("a");b.className="text-info hover:text-info-strong",b.href=i.url,b.download=i.name||`file-${f+1}`,b.textContent=i.name||`File ${f+1}`,c.appendChild(b)}else{let b=e.createElement("span");b.textContent=i.name||`File ${f+1}`,c.appendChild(b)}u.appendChild(c);let h=e.createElement("td");h.className="px-3 py-2 text-muted-strong",h.textContent=Y(i.length)||"0 B",u.appendChild(h);let W=e.createElement("td");W.className="px-3 py-2";let H=e.createElement("select");H.className="select",H.name=`${i.name||`file-${f+1}`}-priority`,H.setAttribute("aria-label",`Set priority for ${i.name||`file ${f+1}`}`),[{value:"1",label:"High priority"},{value:"0",label:"Low priority"},{value:"-1",label:"Don't download"}].forEach(b=>{let $=e.createElement("option");$.value=b.value,$.textContent=b.label,b.value===i.priority&&($.selected=!0),H.appendChild($)}),H.value=i.priority??"0",H.addEventListener("change",b=>{ot(i,b.target.value)}),W.appendChild(H),u.appendChild(W),a.fileList.appendChild(u)}))}function y(){if(!a.selectedSection)return;let s=T();d.selectedTorrent=me(d.selectedTorrent,s);let i=d.selectedTorrent;a.selectedSection.hidden=!i,i&&(a.selectedName&&(a.selectedName.textContent=i.name||"Untitled torrent"),a.pauseButton&&(a.pauseButton.hidden=i.paused===!0,a.pauseButton.disabled=i.paused===!0),a.resumeButton&&(a.resumeButton.hidden=i.paused!==!0,a.resumeButton.disabled=i.paused!==!0),a.downloadAllButton&&(a.downloadAllButton.disabled=!(i.progress>=1)),a.infoHashValue&&(a.infoHashValue.textContent=i.infoHash||""),B(i))}function x(s,{isSeed:i=!1}={}){C(!1),nt(s),i||n.info(`Received ${s.name||"torrent"} metadata`),d.selectedTorrent||(d.selectedTorrent=s),y(),p?.render(T(),d.selectedTorrent)}function U(s){let i=typeof s=="string"?s.trim():"";i&&(C(!0),l.add(i,fe,f=>{x(f,{isSeed:!1})}))}function v(s){!Array.isArray(s)||s.length===0||(C(!0),l.seed(s,fe,i=>{x(i,{isSeed:!0}),n.success(`Seeding ${i.files.length} file(s)`)}))}function g(s){if(s){if(s.progress<1){n.warn("Torrent is not finished downloading yet.");return}s.files.forEach(i=>{typeof i.getBlob=="function"&&i.getBlob((f,u)=>{if(f||!u){E.error("[beacon] Failed to get blob for file",i?.name,f),n.error("Failed to prepare file for download.");return}let c=URL.createObjectURL(u),h=e.createElement("a");h.className="beacon-hidden-download",h.setAttribute("data-beacon-hidden-download","true"),h.href=c,h.download=i.name||"download",e.body.appendChild(h),h.click(),e.body.removeChild(h),URL.revokeObjectURL(c)})})}}function w(s){if(!s?.magnetURI)return;let i=s.magnetURI,f=r?.navigator?.clipboard;if(f&&typeof f.writeText=="function"){f.writeText(i).then(()=>{n.success("Magnet URI copied to clipboard!")}).catch(u=>{E.error("[beacon] Clipboard error",u),n.error("Failed to copy magnet URI")});return}try{let u=e.createElement("textarea");u.value=i,u.className="beacon-clipboard-offscreen",u.setAttribute("data-beacon-clipboard-state","offscreen"),e.body.appendChild(u),u.select(),e.execCommand?.("copy"),e.body.removeChild(u),n.success("Magnet URI copied (fallback)!")}catch(u){E.error("[beacon] Clipboard fallback error",u),n.error("Failed to copy magnet URI")}}function D(s){s&&s.destroy(i=>{i&&(E.error("[beacon] Failed to destroy torrent",i),n.error("Failed to remove torrent"));let f=T();d.selectedTorrent=me(null,f),p?.render(f,d.selectedTorrent),y()})}function z(){if(L.info(`[beacon] Starting beacon runtime v${Qe}`),n||L.warn("[beacon] Toast service unavailable"),o.WEBRTC_SUPPORT||n?.error("Please use a browser with WebRTC support.",{sticky:!0}),a.form){let c=h=>{h.preventDefault(),U(a.magnetInput?.value||""),a.magnetInput&&(a.magnetInput.value="")};a.form.addEventListener("submit",c),m(()=>a.form.removeEventListener("submit",c))}if(a.seedButton&&a.seedInput){let c=()=>{a.seedInput.click()},h=()=>{let W=Array.from(a.seedInput.files||[]);a.seedInput.value="",v(W)};a.seedButton.addEventListener("click",c),a.seedInput.addEventListener("change",h),m(()=>{a.seedButton.removeEventListener("click",c),a.seedInput.removeEventListener("change",h)})}if(a.pauseButton){let c=()=>{d.selectedTorrent&&typeof d.selectedTorrent.pause=="function"&&(d.selectedTorrent.pause(),y())};a.pauseButton.addEventListener("click",c),m(()=>a.pauseButton.removeEventListener("click",c))}if(a.resumeButton){let c=()=>{d.selectedTorrent&&typeof d.selectedTorrent.resume=="function"&&(d.selectedTorrent.resume(),y())};a.resumeButton.addEventListener("click",c),m(()=>a.resumeButton.removeEventListener("click",c))}if(a.downloadAllButton){let c=()=>g(d.selectedTorrent);a.downloadAllButton.addEventListener("click",c),m(()=>a.downloadAllButton.removeEventListener("click",c))}if(a.removeButton){let c=()=>D(d.selectedTorrent);a.removeButton.addEventListener("click",c),m(()=>a.removeButton.removeEventListener("click",c))}if(a.copyMagnetButton){let c=()=>w(d.selectedTorrent);a.copyMagnetButton.addEventListener("click",c),m(()=>a.copyMagnetButton.removeEventListener("click",c))}let s=c=>{E.error("[beacon] Torrent client error",c),n?.error(c?.message||String(c)),C(!1)};l.on("error",s),m(()=>l.removeListener("error",s));let i=c=>{if(l.torrents&&l.torrents.length>0)return c.preventDefault(),c.returnValue="Transfers are in progress. Are you sure you want to leave or refresh?",c.returnValue};r&&typeof r.addEventListener=="function"&&(r.addEventListener("beforeunload",i),m(()=>r.removeEventListener("beforeunload",i))),p?.render(T(),d.selectedTorrent),y(),O(),C(!1);let f=r.setInterval(()=>{p?.render(T(),d.selectedTorrent),y(),O()},1e3);_.push(f);let u=r?.location?.hash;typeof u=="string"&&u.length>1&&U(u.slice(1))}function Q(){_.forEach(s=>r.clearInterval(s)),_.length=0,A.forEach(s=>{try{s()}catch(i){L.warn("[beacon] Cleanup task failed",i)}}),A.length=0,p?.destroy();try{l.destroy()}catch(s){L.warn("[beacon] Failed to destroy client",s)}}return{mount:z,destroy:Q}}function at(){return typeof window<"u"&&window||typeof globalThis<"u"&&globalThis||null}function st(){let e=at();if(e&&typeof e.WebTorrent=="function")return e.WebTorrent;throw new Error("WebTorrent runtime is not available on the global scope")}var j=null,it=()=>{try{ie()}catch(e){L.warn("[beacon] Failed to initialize theme controller",e)}};it();function Te(){if(j)return L.info("[beacon] Reusing existing beacon app instance"),j;if(typeof document>"u")throw new Error("Beacon runtime requires a document environment");let e=st();return L.info("[beacon] Creating beacon app instance"),j=Ee({documentRef:document,WebTorrentCtor:e}),j.mount(),j}if(typeof document<"u")if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>{try{Te()}catch(e){E.error("[beacon] Failed to mount app",e)}});else try{Te()}catch(e){E.error("[beacon] Failed to mount app",e)}export{Ee as createBeaconApp,Te as mountBeaconApp};
