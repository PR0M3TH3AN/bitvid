import { ProfileModalController } from '../../js/ui/profileModalController.js';&#10;import { userLogger } from '../../js/utils/logger.js';&#10;&#10;describe('ProfileModalController - Direct Messages Error Handling', () =&gt; {&#10;  let controller;&#10;  let mockUserLoggerWarn;&#10;&#10;  beforeEach(() =&gt; {&#10;    jest.spyOn(userLogger, 'warn').mockImplementation(() =&gt; {});&#10;    mockUserLoggerWarn = jest.spyOn(userLogger, 'warn');&#10;    controller = new ProfileModalController({ /* minimal mocks for services/state */ });&#10;    jest.spyOn(controller, 'setMessagesLoadingState');&#10;    jest.spyOn(controller, 'setMessagesAnnouncement');&#10;    jest.spyOn(controller, 'updateMessagesReloadState');&#10;    controller.directMessagesCache = []; // Empty for error state&#10;  });&#10;&#10;  afterEach(() =&gt; {&#10;    jest.restoreAllMocks();&#10;  });&#10;&#10;  it('handles &quot;no-decryptors&quot; with specific message, no warn log, and enables reload', () =&gt; {&#10;    const detail = {&#10;      context: { reason: 'no-decryptors' },&#10;      error: new Error('Mock signer unlock error')&#10;    };&#10;    controller.handleDirectMessagesError(detail);&#10;&#10;    expect(controller.setMessagesLoadingState).toHaveBeenCalledWith('error', {&#10;      message: 'Unlock your signer to read direct messages.'&#10;    });&#10;    expect(mockUserLoggerWarn).not.toHaveBeenCalled(); // No log for this reason&#10;    expect(controller.updateMessagesReloadState).toHaveBeenCalled(); // Reload affordance&#10;  });&#10;&#10;  it('handles other reasons with generic message, warn log, and enables reload', () =&gt; {&#10;    const detail = {&#10;      context: { reason: 'relay-failed' }, // Mock real transport error&#10;      error: new Error('Mock relay error')&#10;    };&#10;    controller.handleDirectMessagesError(detail);&#10;&#10;    expect(controller.setMessagesLoadingState).toHaveBeenCalledWith('error', {&#10;      message: 'Unable to sync direct messages right now.'&#10;    });&#10;    expect(mockUserLoggerWarn).toHaveBeenCalledWith(&#10;      '[profileModal] Direct message sync issue detected:',&#10;      detail.error&#10;    ); // Warn for transport errors&#10;    expect(controller.updateMessagesReloadState).toHaveBeenCalled(); // Reload affordance&#10;  });&#10;&#10;  it('handles non-empty cache for &quot;no-decryptors&quot; (announcement only, no error state)', () =&gt; {&#10;    controller.directMessagesCache = ['mock-message']; // Non-empty&#10;    const detail = { context: { reason: 'no-decryptors' } };&#10;    controller.handleDirectMessagesError(detail);&#10;&#10;    // Uses announcement, not error state&#10;    expect(controller.setMessagesAnnouncement).toHaveBeenCalledWith('Unable to sync direct messages right now.');&#10;    expect(mockUserLoggerWarn).not.toHaveBeenCalled();&#10;  });&#10;&#10;  it('maintains behavior for active requests (ignores detail, no state change)', () =&gt; {&#10;    controller.activeMessagesRequest = Symbol('active');&#10;    const detail = { context: { reason: 'no-decryptors' } };&#10;    controller.handleDirectMessagesError(detail);&#10;&#10;    expect(controller.setMessagesLoadingState).not.toHaveBeenCalled();&#10;    expect(controller.setMessagesAnnouncement).not.toHaveBeenCalled();&#10;    expect(mockUserLoggerWarn).toHaveBeenCalled(); // Still logs for diagnostics&#10;  });&#10;&#10;});&#10;&#10;// Adjust existing tests to cover &quot;no-decryptors&quot; in DM flows (e.g., error simulation in populateProfileMessages)
